#!/usr/bin/env python
from optparse import OptionParser

if __name__ == "__main__":
    usage = "usage: %prog install|uninstall [path]"
    desc = "[Un]installs exploitable gdb plugin to PATH, or GDB data dir if no "  +\
           "path is specified."
        
    op = OptionParser(description=desc, usage=usage)

    (opts, args) = op.parse_args()
    print args
    if len(args) < 1:
        op.error("wrong number of arguments")
    if len(args) == 1:
        import subprocess, shlex, re
        path = subprocess.check_output(shlex.split(
            "gdb --batch -ex 'show data-directory'")).strip()
        match = re.match("^.*\"(.*)\".*$", path)
        if not match:
            raise Exception("GDB data directory parse command failed, "
                    "make sure GDB is installed and try specifying a path "
                    "manually")
        path = match.groups()[0]
    elif len(args) == 2:
        path = args[2]
    if args[1] == "install":
        pass
    elif args[1] == "uninstall":
        pass
    else:
        op.error("first arg is incorrect")

    print path
