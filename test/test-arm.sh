#!/bin/bash
#
# TODO: describe this file.
#
# jmfoote@loyola.edu

echo "It's go time!" # &> log-setup.txt # use this redirection for cloudinit

# install keys for accessing private git repo (included this while it is fresh so I don't forget how to do it)
#sudo echo "priv deploy key here" > ~/.ssh/id_rsa
#sudo chmod 600 ~/.ssh/id_rsa # &>> log-setup.txt
#sudo echo "pub deploy key here" > ~/.ssh/id_rsa.pub
#sudo chmod 644 ~/.ssh/id_rsa.pub # &>> log-setup.txt
#sudo echo "pub key for control box here" >> ~/.ssh/authorized_keys
#sudo chmod 600 ~/.ssh/authorized_keys # &>> log-setup.txt
#sudo echo "known host for git server here if cloning over ssh" # &>> ~/.ssh/known_hosts
#sudo chmod 644 ~/known_hosts
#sudo chown admin ~/.ssh/*

# get project code (travis-ci does this automagically)
#git clone https://github.com/jfoote/exploitable -b integration

# install dependencies 
sudo apt-get update
sudo apt-get install gdb gcc python --yes # &>> log-setup.txt # essentials for x86
sudo apt-get install git vim psmisc --yes # &>> log-setup.txt # dev tools
sudo apt-get install qemu python-pip --yes # &>> log-setup.txt # arm testing 
sudo pip install boto # &>> log-setup.txt

# note: for cloudinit, change user commands to this form: su <username> -c "command"
wget http://wiki.qemu.org/download/arm-test-0.2.tar.gz # &>> log-setup.txt # arm disk image
tar -xzf arm-test-0.2.tar.gz # dir is arm-test

# get arm cross-compile toolchain. the toolchain is stored in a private S3 
# bucket; we use travis-ci encryption to protect the keys to the bucket
# ref: http://about.travis-ci.org/docs/user/encryption-keys/
python -c 'import boto, os; boto.connect_s3(os.environ["AWS_ACCESS_KEY_ID"], os.environ["AWS_SECRET_ACCESS_KEY"]).get_bucket("exploitable").get_key("arm-toolchain.tar.bz2").get_contents_to_filename("arm-toolchain.tar.bz2")'
tar -xjf arm-toolchain.tar.bz2 # dir is arm-2013.11

ls -R .

echo "done" # &>> log-setup.txt


